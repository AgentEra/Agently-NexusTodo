# NexusTodo 后端关键用例文档

## 1. 用例图

```mermaid
useCaseDiagram
    actor Client as 桌面客户端
    actor Admin as 管理员
    
    Client -->> 设备注册
    Client -->> 获取任务列表
    Client -->> 创建任务
    Client -->> 更新任务
    Client -->> 删除任务
    Client -->> 设备状态检查
    Admin -->> 数据清理
    
    设备注册 ..>> 设备管理
    获取任务列表 ..>> 任务管理
    创建任务 ..>> 任务管理
    更新任务 ..>> 任务管理
    删除任务 ..>> 任务管理
    设备状态检查 ..>> 设备管理
    数据清理 ..>> 系统管理
    
    note right of Client: 普通用户操作
    note right of Admin: 管理员操作
```

## 2. 详细用例描述

### 2.1 设备注册

#### 2.1.1 基本信息
- **用例ID**：UC-001
- **用例名称**：设备注册
- **参与者**：桌面客户端
- **功能点**：F1.1 设备注册
- **优先级**：高

#### 2.1.2 前置条件
- 客户端首次启动
- 客户端已生成设备UUID
- 客户端可以访问后端API

#### 2.1.3 后置条件
- 设备成功注册到后端系统
- 设备与用户关联
- 客户端获取到用户ID

#### 2.1.4 流程描述

| 步骤 | 参与者动作 | 系统响应 | 分支/异常 |
| :--- | :--- | :--- | :--- |
| 1 | 客户端生成设备UUID | - | - |
| 2 | 客户端发送POST请求到 `/api/device/register`，携带deviceId | 后端接收请求，验证deviceId格式 | deviceId格式错误：返回400错误 |
| 3 | - | 后端检查设备是否已注册 | - |
| 4 | - | 若设备未注册，创建新设备记录并绑定默认用户 | - |
| 5 | - | 若设备已注册，更新设备最后活跃时间 | - |
| 6 | - | 后端返回设备ID、用户ID和注册成功消息 | - |
| 7 | 客户端存储设备ID和用户ID | - | - |

#### 2.1.5 输入/输出示例

**输入**：
```json
{
  "deviceId": "550e8400-e29b-41d4-a716-446655440000"
}
```

**输出**：
```json
{
  "deviceId": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "message": "注册成功"
}
```

### 2.2 获取任务列表

#### 2.2.1 基本信息
- **用例ID**：UC-002
- **用例名称**：获取任务列表
- **参与者**：桌面客户端
- **功能点**：F2.1 获取任务列表
- **优先级**：高

#### 2.2.2 前置条件
- 设备已注册
- 客户端已获取用户ID
- 客户端可以访问后端API

#### 2.2.3 后置条件
- 客户端获取到最新的任务列表
- 任务列表按状态和标签过滤（如果有过滤条件）

#### 2.2.4 流程描述

| 步骤 | 参与者动作 | 系统响应 | 分支/异常 |
| :--- | :--- | :--- | :--- |
| 1 | 客户端发送GET请求到 `/api/tasks`，可选携带查询参数 | 后端接收请求，验证默认Token | Token无效：返回401错误 |
| 2 | - | 后端从请求头获取用户ID | - |
| 3 | - | 后端根据查询参数过滤任务 | - |
| 4 | - | 后端返回符合条件的任务列表 | 网络错误：返回500错误 |
| 5 | 客户端接收并展示任务列表 | - | - |

#### 2.2.5 输入/输出示例

**输入**：
```
GET /api/tasks?status=待办&tags=work,urgent
请求头：
Authorization: Bearer default-token
X-User-ID: 123e4567-e89b-12d3-a456-426614174000
```

**输出**：
```json
[
  {
    "taskId": "111e2222-e89b-12d3-a456-426614174000",
    "userId": "123e4567-e89b-12d3-a456-426614174000",
    "title": "完成项目报告",
    "description": "撰写本周项目进展报告",
    "status": "待办",
    "tags": ["work", "urgent"],
    "createdAt": "2023-06-01T10:00:00Z",
    "updatedAt": "2023-06-01T10:00:00Z"
  },
  {
    "taskId": "222e3333-e89b-12d3-a456-426614174000",
    "userId": "123e4567-e89b-12d3-a456-426614174000",
    "title": "准备会议材料",
    "description": "准备明天的团队会议材料",
    "status": "待办",
    "tags": ["work", "urgent"],
    "createdAt": "2023-06-01T09:00:00Z",
    "updatedAt": "2023-06-01T09:00:00Z"
  }
]
```

### 2.3 创建任务

#### 2.3.1 基本信息
- **用例ID**：UC-003
- **用例名称**：创建任务
- **参与者**：桌面客户端
- **功能点**：F2.2 创建任务
- **优先级**：高

#### 2.3.2 前置条件
- 设备已注册
- 客户端已获取用户ID
- 客户端可以访问后端API

#### 2.3.3 后置条件
- 任务成功创建
- 任务状态默认为"待办"
- 客户端获取到新创建的任务信息

#### 2.3.4 流程描述

| 步骤 | 参与者动作 | 系统响应 | 分支/异常 |
| :--- | :--- | :--- | :--- |
| 1 | 客户端填写任务信息（标题、描述、标签） | - | - |
| 2 | 客户端发送POST请求到 `/api/tasks`，携带任务数据 | 后端接收请求，验证任务数据 | 数据验证失败：返回400错误 |
| 3 | - | 后端从请求头获取用户ID | - |
| 4 | - | 后端创建新任务记录 | - |
| 5 | - | 后端返回新创建的任务信息（201 Created） | 网络错误：返回500错误 |
| 6 | 客户端接收并展示新任务 | - | - |

#### 2.3.5 输入/输出示例

**输入**：
```
POST /api/tasks
请求头：
Authorization: Bearer default-token
X-User-ID: 123e4567-e89b-12d3-a456-426614174000

请求体：
{
  "title": "完成代码审查",
  "description": "审查团队成员提交的代码",
  "tags": ["work", "code-review"]
}
```

**输出**：
```json
{
  "taskId": "333e4444-e89b-12d3-a456-426614174000",
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "title": "完成代码审查",
  "description": "审查团队成员提交的代码",
  "status": "待办",
  "tags": ["work", "code-review"],
  "createdAt": "2023-06-01T11:00:00Z",
  "updatedAt": "2023-06-01T11:00:00Z"
}
```

### 2.4 更新任务

#### 2.4.1 基本信息
- **用例ID**：UC-004
- **用例名称**：更新任务
- **参与者**：桌面客户端
- **功能点**：F2.3 更新任务
- **优先级**：高

#### 2.4.2 前置条件
- 设备已注册
- 客户端已获取用户ID
- 任务已存在
- 客户端可以访问后端API

#### 2.4.3 后置条件
- 任务信息成功更新
- 客户端获取到更新后的任务信息

#### 2.4.4 流程描述

| 步骤 | 参与者动作 | 系统响应 | 分支/异常 |
| :--- | :--- | :--- | :--- |
| 1 | 客户端修改任务信息（标题、描述、状态、标签） | - | - |
| 2 | 客户端发送PUT请求到 `/api/tasks/:taskId`，携带更新数据 | 后端接收请求，验证更新数据 | 数据验证失败：返回400错误 |
| 3 | - | 后端从请求头获取用户ID | - |
| 4 | - | 后端检查任务是否存在且属于该用户 | 任务不存在：返回404错误；任务不属于该用户：返回403错误 |
| 5 | - | 后端更新任务信息 | - |
| 6 | - | 后端返回更新后的任务信息 | 网络错误：返回500错误 |
| 7 | 客户端接收并展示更新后的任务 | - | - |

#### 2.4.5 输入/输出示例

**输入**：
```
PUT /api/tasks/333e4444-e89b-12d3-a456-426614174000
请求头：
Authorization: Bearer default-token
X-User-ID: 123e4567-e89b-12d3-a456-426614174000

请求体：
{
  "status": "进行中",
  "description": "审查团队成员提交的代码，重点关注性能问题"
}
```

**输出**：
```json
{
  "taskId": "333e4444-e89b-12d3-a456-426614174000",
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "title": "完成代码审查",
  "description": "审查团队成员提交的代码，重点关注性能问题",
  "status": "进行中",
  "tags": ["work", "code-review"],
  "createdAt": "2023-06-01T11:00:00Z",
  "updatedAt": "2023-06-01T12:00:00Z"
}
```

### 2.5 删除任务

#### 2.5.1 基本信息
- **用例ID**：UC-005
- **用例名称**：删除任务
- **参与者**：桌面客户端
- **功能点**：F2.4 删除任务
- **优先级**：高

#### 2.5.2 前置条件
- 设备已注册
- 客户端已获取用户ID
- 任务已存在
- 客户端可以访问后端API

#### 2.5.3 后置条件
- 任务成功删除
- 客户端收到删除成功消息

#### 2.5.4 流程描述

| 步骤 | 参与者动作 | 系统响应 | 分支/异常 |
| :--- | :--- | :--- | :--- |
| 1 | 客户端选择要删除的任务 | - | - |
| 2 | 客户端发送DELETE请求到 `/api/tasks/:taskId` | 后端接收请求 | - |
| 3 | - | 后端从请求头获取用户ID | - |
| 4 | - | 后端检查任务是否存在且属于该用户 | 任务不存在：返回404错误；任务不属于该用户：返回403错误 |
| 5 | - | 后端删除任务记录 | - |
| 6 | - | 后端返回删除成功消息 | 网络错误：返回500错误 |
| 7 | 客户端接收删除成功消息并更新界面 | - | - |

#### 2.5.5 输入/输出示例

**输入**：
```
DELETE /api/tasks/333e4444-e89b-12d3-a456-426614174000
请求头：
Authorization: Bearer default-token
X-User-ID: 123e4567-e89b-12d3-a456-426614174000
```

**输出**：
```json
{
  "message": "删除成功"
}
```

### 2.6 设备状态检查

#### 2.6.1 基本信息
- **用例ID**：UC-006
- **用例名称**：设备状态检查
- **参与者**：桌面客户端
- **功能点**：F1.2 设备状态检查
- **优先级**：中

#### 2.6.2 前置条件
- 设备已注册
- 客户端可以访问后端API

#### 2.6.3 后置条件
- 客户端获取到设备状态信息
- 设备最后活跃时间更新

#### 2.6.4 流程描述

| 步骤 | 参与者动作 | 系统响应 | 分支/异常 |
| :--- | :--- | :--- | :--- |
| 1 | 客户端发送GET请求到 `/api/device/status` | 后端接收请求，验证默认Token | Token无效：返回401错误 |
| 2 | - | 后端从请求头获取设备ID和用户ID | - |
| 3 | - | 后端检查设备状态 | 设备不存在：返回404错误 |
| 4 | - | 后端更新设备最后活跃时间 | - |
| 5 | - | 后端返回设备状态信息 | 网络错误：返回500错误 |
| 6 | 客户端接收设备状态信息 | - | - |

#### 2.6.5 输入/输出示例

**输入**：
```
GET /api/device/status
请求头：
Authorization: Bearer default-token
X-Device-ID: 550e8400-e29b-41d4-a716-446655440000
X-User-ID: 123e4567-e89b-12d3-a456-426614174000
```

**输出**：
```json
{
  "deviceId": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "123e4567-e89b-12d3-a456-426614174000",
  "lastSeenAt": "2023-06-01T13:00:00Z"
}
```

### 2.7 数据清理

#### 2.7.1 基本信息
- **用例ID**：UC-007
- **用例名称**：数据清理
- **参与者**：管理员
- **功能点**：F6.2 数据清理
- **优先级**：低

#### 2.7.2 前置条件
- 管理员可以访问管理接口
- 存在长期未活跃的设备

#### 2.7.3 后置条件
- 长期未活跃的设备及关联数据被清理
- 系统资源得到释放

#### 2.7.4 流程描述

| 步骤 | 参与者动作 | 系统响应 | 分支/异常 |
| :--- | :--- | :--- | :--- |
| 1 | 管理员访问数据清理接口 | - | - |
| 2 | 管理员设置清理条件（如：超过30天未活跃） | - | - |
| 3 | 管理员执行清理操作 | 系统查找符合条件的设备 | - |
| 4 | - | 系统删除符合条件的设备及关联数据 | - |
| 5 | - | 系统返回清理结果 | - |
| 6 | 管理员查看清理结果 | - | - |

## 3. 异常用例处理

### 3.1 网络中断

#### 3.1.1 基本信息
- **用例ID**：UC-EX-001
- **用例名称**：网络中断处理
- **参与者**：桌面客户端
- **功能点**：F5.1 网络中断处理
- **优先级**：中

#### 3.1.2 前置条件
- 客户端正在执行需要网络的操作
- 网络连接中断

#### 3.1.3 流程描述

| 步骤 | 参与者动作 | 系统响应 | 分支/异常 |
| :--- | :--- | :--- | :--- |
| 1 | 客户端执行需要网络的操作（如创建任务） | - | - |
| 2 | 网络连接中断 | 后端无法接收请求 | - |
| 3 | - | 客户端检测到网络错误 | - |
| 4 | 客户端显示错误提示："网络连接失败，操作未保存" | - | - |
| 5 | 网络恢复后，客户端重新尝试操作 | - | - |

### 3.2 认证失败

#### 3.2.1 基本信息
- **用例ID**：UC-EX-002
- **用例名称**：认证失败处理
- **参与者**：桌面客户端
- **功能点**：F4.1 认证失败处理
- **优先级**：中

#### 3.2.2 前置条件
- 客户端发送请求到后端
- 请求中的认证信息无效

#### 3.2.3 流程描述

| 步骤 | 参与者动作 | 系统响应 | 分支/异常 |
| :--- | :--- | :--- | :--- |
| 1 | 客户端发送请求，携带无效的默认Token | 后端接收请求 | - |
| 2 | - | 后端验证Token，发现无效 | - |
| 3 | - | 后端返回401 Unauthorized错误 | - |
| 4 | 客户端接收错误，显示认证失败提示 | - | - |
| 5 | 客户端重新获取有效的Token | - | - |

### 3.3 授权失败

#### 3.3.1 基本信息
- **用例ID**：UC-EX-003
- **用例名称**：授权失败处理
- **参与者**：桌面客户端
- **功能点**：F4.2 授权失败处理
- **优先级**：中

#### 3.3.2 前置条件
- 客户端发送请求到后端
- 请求中的用户ID与资源所有者不匹配

#### 3.3.3 流程描述

| 步骤 | 参与者动作 | 系统响应 | 分支/异常 |
| :--- | :--- | :--- | :--- |
| 1 | 客户端发送请求，尝试访问不属于自己的任务 | 后端接收请求 | - |
| 2 | - | 后端验证用户ID与任务所有者，发现不匹配 | - |
| 3 | - | 后端返回403 Forbidden错误 | - |
| 4 | 客户端接收错误，显示授权失败提示 | - | - |
| 5 | 客户端停止尝试访问该资源 | - | - |

## 4. 用例优先级矩阵

| 用例ID | 用例名称 | 优先级 | 复杂度 | 风险 |
| :--- | :--- | :--- | :--- | :--- |
| UC-001 | 设备注册 | 高 | 低 | 低 |
| UC-002 | 获取任务列表 | 高 | 低 | 低 |
| UC-003 | 创建任务 | 高 | 低 | 低 |
| UC-004 | 更新任务 | 高 | 低 | 低 |
| UC-005 | 删除任务 | 高 | 低 | 低 |
| UC-006 | 设备状态检查 | 中 | 低 | 低 |
| UC-007 | 数据清理 | 低 | 中 | 中 |
| UC-EX-001 | 网络中断处理 | 中 | 低 | 低 |
| UC-EX-002 | 认证失败处理 | 中 | 低 | 低 |
| UC-EX-003 | 授权失败处理 | 中 | 低 | 低 |

## 5. 总结

本用例文档详细描述了 NexusTodo 后端系统的关键用例，包括设备注册、任务管理、设备状态检查等核心功能，以及网络中断、认证失败、授权失败等异常情况的处理流程。这些用例覆盖了后端系统的主要功能点，为开发和测试提供了明确的指导。

通过这些用例的实现，后端系统将能够满足 NexusTodo 桌面应用的所有功能需求，为用户提供稳定、安全、高效的服务。