# NexusTodo 后端功能列表

## 1. 设备管理功能

### 1.1 设备注册
- **功能描述**：设备首次启动时，客户端生成UUID并发送到后端进行注册
- **API路径**：`POST /api/device/register`
- **请求参数**：
  - `deviceId`：设备唯一标识符（UUID格式）
- **响应内容**：
  - `deviceId`：设备ID
  - `userId`：关联的用户ID
  - `message`：注册结果消息
- **业务逻辑**：
  - 检查设备是否已注册
  - 若未注册，创建新设备记录并绑定默认用户
  - 若已注册，更新设备最后活跃时间
  - 返回设备和用户信息

### 1.2 设备状态检查
- **功能描述**：检查设备的注册状态和关联信息
- **API路径**：`GET /api/device/status`
- **响应内容**：
  - `deviceId`：设备ID
  - `userId`：关联的用户ID
  - `lastSeenAt`：最后活跃时间

## 2. 任务管理功能

### 2.1 创建任务
- **功能描述**：创建新的任务
- **API路径**：`POST /api/tasks`
- **请求参数**：
  - `title`：任务标题（必填）
  - `description`：任务描述（可选）
  - `tags`：自定义标签数组（可选）
- **响应内容**：
  - 完整的任务信息，包括任务ID、标题、描述、状态、标签等
- **业务逻辑**：
  - 验证请求数据
  - 从请求头获取用户ID
  - 创建新任务记录，默认状态为"待办"
  - 返回新任务信息

### 2.2 获取任务列表
- **功能描述**：获取用户的任务列表，支持按状态和标签过滤
- **API路径**：`GET /api/tasks`
- **查询参数**：
  - `status`：任务状态过滤（可选）
  - `tags`：标签过滤（可选，多个标签用逗号分隔）
- **响应内容**：
  - 任务列表，每个任务包含完整信息
- **业务逻辑**：
  - 从请求头获取用户ID
  - 根据查询参数过滤任务
  - 返回符合条件的任务列表

### 2.3 获取任务详情
- **功能描述**：获取单个任务的详细信息
- **API路径**：`GET /api/tasks/:taskId`
- **响应内容**：
  - 完整的任务信息
- **业务逻辑**：
  - 从请求头获取用户ID
  - 检查任务是否存在且属于该用户
  - 返回任务详细信息

### 2.4 更新任务
- **功能描述**：更新任务的信息，包括标题、描述、状态、标签等
- **API路径**：`PUT /api/tasks/:taskId`
- **请求参数**：
  - `title`：任务标题（可选）
  - `description`：任务描述（可选）
  - `status`：任务状态（可选，值为：待办、进行中、已完成、已延期、已取消）
  - `tags`：自定义标签数组（可选）
- **响应内容**：
  - 更新后的完整任务信息
- **业务逻辑**：
  - 验证请求数据
  - 从请求头获取用户ID
  - 检查任务是否存在且属于该用户
  - 更新任务信息
  - 返回更新后的任务信息

### 2.5 删除任务
- **功能描述**：删除指定的任务
- **API路径**：`DELETE /api/tasks/:taskId`
- **响应内容**：
  - `message`：删除成功消息
- **业务逻辑**：
  - 从请求头获取用户ID
  - 检查任务是否存在且属于该用户
  - 删除任务记录
  - 返回删除成功消息

## 3. 认证与授权功能

### 3.1 默认Token认证
- **功能描述**：使用默认Token进行API认证
- **实现方式**：
  - 客户端在请求头中传递默认Token
  - 服务端验证Token的有效性
  - 验证设备ID与用户ID的绑定关系

### 3.2 授权检查
- **功能描述**：确保用户只能访问自己的任务数据
- **实现方式**：
  - 在任务相关API中，检查任务是否属于当前用户
  - 若不属于，返回授权错误

## 4. 数据安全功能

### 4.1 数据传输安全
- **功能描述**：确保API通信安全
- **实现方式**：
  - 所有API通信使用HTTPS

### 4.2 数据存储安全
- **功能描述**：确保数据存储安全
- **实现方式**：
  - 敏感数据加密存储
  - SQLite数据库文件权限控制

### 4.3 输入验证
- **功能描述**：防止注入攻击和非法输入
- **实现方式**：
  - 严格验证所有输入数据
  - 使用Gin框架的binding标签进行参数验证

## 5. 防滥用措施

### 5.1 速率限制
- **功能描述**：防止恶意请求和DoS攻击
- **实现方式**：
  - 对API请求实施速率限制
  - 限制单个IP或设备的请求频率

### 5.2 日志记录
- **功能描述**：记录API请求和关键操作，便于审计和问题排查
- **实现方式**：
  - 记录所有API请求的详细信息
  - 记录设备注册、任务创建/更新/删除等关键操作
  - 使用JSON格式日志，便于日志系统解析

## 6. 监控与维护功能

### 6.1 错误处理
- **功能描述**：统一处理和响应错误
- **实现方式**：
  - 实现统一的错误响应格式
  - 定义标准错误码，便于前端处理
  - 详细记录错误信息，便于问题排查

### 6.2 数据清理
- **功能描述**：清理长期未活跃的设备及关联数据
- **实现方式**：
  - 提供管理接口，清理长期未活跃的设备
  - 定期备份数据库，防止数据丢失

## 7. 扩展性功能

### 7.1 多设备支持
- **功能描述**：支持一个用户关联多个设备
- **实现方式**：
  - 设备注册时，将设备与用户关联
  - 确保多设备数据一致性

### 7.2 未来功能扩展
- **功能描述**：为未来功能预留扩展空间
- **预留功能**：
  - 用户认证：支持用户账号登录
  - 任务提醒：实现任务提醒功能
  - 数据分析：提供任务完成情况分析
  - API版本控制：设计API版本控制机制

## 8. 系统管理功能

### 8.1 配置管理
- **功能描述**：管理系统配置
- **配置项**：
  - `DATABASE_PATH`：SQLite数据库文件路径
  - `PORT`：服务端口
  - `DEFAULT_TOKEN`：默认认证令牌

### 8.2 数据库初始化
- **功能描述**：系统启动时初始化数据库
- **实现方式**：
  - 自动创建数据库文件（若不存在）
  - 自动迁移数据模型，创建表结构
