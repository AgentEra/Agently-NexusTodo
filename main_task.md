### **Spec-DD：个人TODO管理桌面应用（代号：NexusTodo）**

#### **1. 背景/目标**
*   **背景**：用户需要一个高度个人化、无需复杂登录、可快速访问的TODO管理工具，以应对日常繁多的任务，并养成晨间规划、晚间复盘的习惯。
*   **目标**：开发一个跨平台桌面客户端原型，实现个人任务的核心管理、分类、状态跟踪与定时提醒功能，数据通过后端服务存储与同步，为用户提供一个无缝的多端体验起点。

#### **2. 用户与场景**
*   **核心用户**：重度依赖TODO列表的专业人士（如本例中的需求提出者）。
*   **主要场景**：
    1.  **晨间规划**：工作开始前，打开桌面客户端，快速浏览按状态（今日待办）和标签过滤的任务列表，规划一天工作。
    2.  **日间执行**：在桌面客户端上随时添加新任务、为任务打标签、更新任务状态（如从“待办”拖拽至“进行中”）。
    3.  **晚间复盘**：工作结束时，客户端界面通过显著视觉提示（如红点、高亮区域）提醒用户。用户点击进入，查看所有任务进展，更新任务状态，整理并关闭已完成事项。

#### **3. 功能清单**
*   **F1. 任务核心管理**：
    *   F1.1 创建/编辑/删除任务（含标题、可选详细描述）。
    *   F1.2 为任务添加/移除多个**自定义标签**（B方式）。
    *   F1.3 设置/更改任务**系统状态**：`待办`， `进行中`， `已完成`， `已延期`（C方式）。
*   **F2. 任务视图与筛选**：
    *   F2.1 主视图默认按状态分组展示任务。
    *   F2.2 支持按一个或多个自定义标签进行筛选。
    *   F2.3 支持按创建时间/截止日期（若未来扩展）排序。
*   **F3. 复盘提醒系统**：
    *   F3.1 客户端在用户预设的“复盘时间”（如18:00）检测，若用户仍在运行，则在应用内触发**视觉提示**（如导航栏出现红点，“复盘”按钮高亮闪烁）。
*   **F4. 数据同步与身份**：
    *   F4.1 客户端首次启动时，自动生成并保存一个唯一的本地设备标识符（UUID）。
    *   F4.2 **所有数据操作**均关联此设备标识符，并自动与后端服务同步（无登录环节）。
    *   F4.3 未来扩展：提供“关联新设备”功能，通过输入统一“默认账号身份”代码（如一个静态令牌），实现跨设备数据统一。
*   **F5. 客户端基础**：基于Electron的跨平台（Windows/macOS）桌面应用，包含基本的菜单、设置（如设置复盘时间）。

#### **4. 用户流程**
1.  **首次启动流程**：
    *   用户下载并打开应用。
    *   应用后台自动生成设备UUID，并与后端建立关联。
    *   用户直接进入空状态的主任务界面，可立即开始创建任务。
2.  **添加任务流程**：
    *   用户点击“+”按钮。
    *   输入任务标题、可选描述。
    *   在输入框中使用`#`符号创建或选择已有标签（如 `#项目A` `#紧急`）。
    *   点击保存，任务以“待办”状态出现在列表中，并同步至云端。
3.  **晚间复盘流程**：
    *   到达预设时间，应用界面出现视觉提示。
    *   用户点击提示区域或“复盘”按钮。
    *   界面可能切换到“复盘模式”，突出显示所有“进行中”和“待办”任务。
    *   用户逐一检查，更新状态，完成后确认，视觉提示消失。

#### **5. 数据结构**
*   **`User` (虚拟实体)**：
    *   `userId`： (String) 对应“默认账号身份”，当前版本为固定值或由后端分配。
    *   `deviceTokens`: (Array) 关联的设备UUID列表，为未来多设备扩展预留。
*   **`Task`**：
    *   `taskId`： (String) 唯一标识。
    *   `userId`： (String) 关联的用户ID。
    *   `title`： (String) 任务标题。
    *   `description`： (String, Optional) 描述。
    *   `status`： (Enum: `[“待办”， “进行中”， “已完成”， “已延期”， “已取消”]`) 系统状态。
    *   `tags`： (Array of String) 自定义标签数组，如 `[“work”， “urgent”]`。
    *   `createdAt`， `updatedAt`： (Timestamp) 时间戳。
*   **`Device`**:
    *   `deviceId`: (String) 客户端生成的UUID。
    *   `userId`: (String) 关联的用户ID。
    *   `lastSeenAt`: (Timestamp) 最后活跃时间。

#### **6. 接口草案**
后端基于Golang实现，提供RESTful API。
*   **`POST /api/device/register`**： 设备首次启动时调用，发送`deviceId`，后端将其与默认`userId`绑定，并返回绑定成功信息。
*   **`GET /api/tasks`**： 获取该`userId`下的所有任务（可查询参数按`status`， `tags`过滤）。
*   **`POST /api/tasks`**： 创建新任务。
*   **`PUT /api/tasks/:taskId`**： 更新任务（状态、标签等）。
*   **`DELETE /api/tasks/:taskId`**： 删除任务。
*   **同步策略**： 客户端每次启动及任务变更后，调用`GET /api/tasks`全量拉取，以确保数据一致。变更多采用乐观更新，本地立即生效后推送至后端。

#### **7. 边界与异常**
*   **网络中断**：由于“不需要离线操作”，网络中断时，所有需要同步的操作（增删改）应失败并给出明确提示：“网络连接失败，操作未保存”。读取操作可显示上次缓存的数据，但需标注“数据可能不是最新”。
*   **冲突处理**：当前版本为纯个人使用，通过“最后写入获胜”策略解决同一任务在多端几乎同时修改的冲突，并在客户端日志记录。
*   **数据清理**：后端提供管理接口，可清理长期未活跃的`Device`及关联的测试数据。

#### **8. 非功能需求**
*   **性能**：应用冷启动时间 < 3秒。任务列表加载（网络良好时） < 1秒。
*   **可用性**：核心操作（添加任务、更改状态）应在3次点击/按键内完成。界面需支持键盘快捷键（如`Ctrl+N`新建）。
*   **安全**：所有API通信必须使用HTTPS。设备标识符（UUID）在本地安全存储。后端验证`deviceId`与`userId`的绑定关系，防止数据越权访问。
*   **兼容性**：Electron应用需兼容Windows 10/11及macOS Big Sur及以上版本。

#### **9. 验收标准**
*   **AC1**：用户在Windows和macOS上均可成功安装并启动应用。
*   **AC2**：用户可以成功创建、编辑、删除任务，并为任务添加自定义标签和更改系统状态。
*   **AC3**：任务数据在应用重启后能正确保留并显示。
*   **AC4**：到达设置的复盘时间，应用内出现明确、可感知的视觉提示（非系统通知）。
*   **AC5**：打开浏览器开发者工具，观察网络请求，确认所有任务操作均触发了与后端（localhost）的正确API通信。

#### **10. 风险与假设**
*   **风险**：
    *   无账号体系下，设备唯一标识符（UUID）若被清除（如清除本地存储），将导致数据无法关联，视为新设备。**缓解**：首次启动时提示用户“请勿随意清除应用数据”，未来版本提供备份/恢复码功能。
    *   Electron应用打包体积可能较大。**缓解**：使用优化依赖，并明确此为桌面原型。
*   **假设**：
    *   用户主要在桌面端使用，移动端非MVP范畴。
    *   当前仅服务于单一用户（一个默认身份），无并发协作需求。
    *   “复盘提醒”依赖客户端进程处于运行状态。若应用关闭，则无法提醒。