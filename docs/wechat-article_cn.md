# 我们用Agently+纯VibeCoding，6小时做了个智能ToDo应用

项目仓库：github.com/AgentEra/Agently-NexusTodo  
Agently 框架：github.com/AgentEra/Agently  
Agently 官网：Agently.tech（EN） / Agently.cn（CN）

你是否无数次幻想过这样的场景：把需求一股脑丢给模型，一路"Accept All"疯狂点击，然后坐等项目自动完美完成？现实中，用VibeCoding写个简单的ToDo确实不难，但想把大模型能力稳稳嵌入系统，还能长期维护，那难度就像登天！

---

最近，在Agently框架核心作者 **莫欣老师** 的一场51CTO直播中，我们进行了一场极限挑战：  
**只用6小时，从零打造一个端到端的智能ToDo系统**（Go后端 + Agently智能服务 + Electron桌面端）。

今天这篇文章，不是来秀成果的。  
我们想分享一个关键发现：  
**VibeCoding看似热闹，但智能体开发的真正难点，从来不在"写代码"，而在如何"把AI的不确定性，做成能上线、跑得稳的真系统"。**

---

### **一、为什么是智能ToDo？它把AI开发的"雷区"踩了个遍**

我们选了"智能ToDo"这个试验场，因为它看似简单，却精准命中了AI应用的所有致命痛点：

*   **需求很"人话"**：用户说的是"帮我找出后天要见客户的所有准备事项"，而不是"调用query接口，过滤date字段"。
*   **操作常"多步"**：先模糊搜索，再按优先级排序，最后批量修改状态——这需要AI自己规划步骤并执行。
*   **交互必须"可信"**：过程要透明（AI到底在想什么），结果要可验证（改对了没有）。
*   **系统必须"稳定"**：不能今天听话，明天换句提示词就"发疯"。

为此，我们设计了**三段式架构**，一次跑通智能系统的全链路：

1.  **Go后端**：坚固的"事实地基"  
    只负责最稳定的核心：任务CRUD、数据存库、用户管理。  
    它的存在，是为了确保**上层AI哪怕"乱来"，数据也有据可依**。

2.  **Python智能服务（基于Agently）**：智慧的"决策大脑"  
    负责理解自然语言指令，管理多轮对话，并**规划与执行**对后端的多次工具调用。

3.  **Electron桌面端**：友好的"交互窗口"  
    既能传统管理，又能对话操作。关键是把**思考过程**和**最终结果**分层展示，建立用户信任。

> **我们的核心策略：先固本，后增智。**  
> 先让后端和客户端的基础架子稳如泰山，再接入智能模块。这样，AI从第一天面对的就是真实战场，而非虚构沙盘。

---

### **二、直播实战：系统可控才是王道**

直播后，我们复盘整个实战过程，问莫欣老师：把智能模块做成工程交付，最关键的是什么？

他的回答，堪称AI工程化的"心法"：

> **1. SpecDD（规范先行）不是形式主义，而是并行开发的"发令枪"。**  
> 花10分钟把目标、边界、成功标准写清楚，能省掉后续10小时的扯皮和返工。
>
> **2. API文档规范不是事后补的说明书，而是团队协作的"宪法"。**  
> 模块之间如何对话必须先定义死。否则联调就是灾难，AI会把任何歧义都放大成事故。
>
> **3. 智能模块要落地，不能靠"硬写"，要靠框架"约束"。**  
> 用可执行的测试把不确定性关进笼子，系统才能既聪明又可靠。

结论就一句话：想让VibeCoding走向实际交付，先得让**系统可控**。  
一个可控的系统，才能让你冷静迭代，快速定位问题，最终交付价值。

---

### **三、四大天坑：如果放任AI"自由发挥"……**

如果让模型硬写智能模块，那可就掉进大坑里了，最常见的坑有这四个：

1.  **"Accept All"幻觉**  
    代码像野草疯长，你逐渐看不懂，修Bug变成了开盲盒。

2.  **质量"长尾"陷阱**  
    前期产出飞快，后期Review、返工、修Bug的成本会悄然吞噬所有优势。

3.  **安全盲区与过度自信**  
    代码更易埋坑，而开发者却更容易"觉得没问题"。AI时代，"错误率上升"和"过度自信"这对危险组合被急剧放大。

4.  **新型供应链风险**  
    AI容易产生"包名幻觉"，误引入恶意依赖（学术界称之为slopsquatting/package hallucination）。

这些坑不高级，但招招致命，专卡在联调、上线、交付这些你最输不起的环节。

---

### **四、Agently：VibeCoding的绝佳搭档**

没有框架支撑的VibeCoding，就像给赛车装上火箭引擎却拆了方向盘：**能飞，但不知会撞向何方。**

在这次项目中，Agently提供了三大工程化能力，把AI的不确定性牢牢收住：

#### **1. 结构化输出：让结果"可被程序读取"**  
用`Output Format`把模型输出锁死成结构化JSON，再用`ensure_keys`为关键字段提供缺失重试兜底。  
从此，解析结果不再靠正则和运气。

```python
from agently import Agently

agent = Agently.create_agent()
result = (
  agent
  .input("把所有包含'测试'的任务删除，并输出删除数量")
  .output({
    "need_delete": ("bool", "是否需要删除"),
    "keyword": ("str", "用于筛选的关键词"),
    "summary": ("str", "给用户的最终说明"),
  })
  .start(
    ensure_keys=["need_delete", "keyword", "summary"],
    max_retries=2,
    raise_ensure_failure=False,
  )
)
print(result) # 直接拿到稳定的字典
```

#### **2. 事件化流式返回：让过程"透明可视"**  
Agently把模型响应统一为标准事件流（如`delta`、`reasoning_delta`、`tool_calls`）。  
前端可以轻松消费这些事件，实现**"思考过程"的实时展示**，用户不再需要"猜"AI在干嘛。

#### **3. TriggerFlow编排：让多步任务"可编排、可调试"**  
把复杂的"思考-行动-观察"循环，写成清晰的**信号-节点-运行态**工作流。  
多步任务不再是黑箱，而是可复盘、可回归、可扩展的标准化流程。

```python
from agently import TriggerFlow, TriggerFlowEventData
flow = TriggerFlow()

@flow.chunk
async def 第一步_设置用户(data: TriggerFlowEventData):
    data.set_runtime_data("user_id", "u-001")
    return "结果1"

@flow.chunk
async def 第二步_设置环境(data: TriggerFlowEventData):
    data.set_runtime_data("env", "prod")
    return "结果2"

# ... 清晰编排，结果汇总
flow.start("start")
```

> **Agently的核心价值，就是让系统更可控：可约束、可编排、可验证。**

---

### **五、拿来即用：你的项目正卡在哪一环？**

很多读者问如何把我们的经验应用到自己项目中，我们总结了3类常见卡点与解药：

*   **卡点一：模型听不懂/输出不稳定，字段时有时无，解析代码脆弱不堪。**  
    **解药**：立刻上`Output Format` + `ensure_keys`。先拿到稳定如磐石的结构化数据，是所有迭代的地基。

*   **卡点二：多步任务做不完/反复兜圈，逻辑混乱，工具调用失控。**  
    **解药**：用`TriggerFlow`把流程显式化、可视化。再用场景化用例脚本做回归测试，确保改动不炸全局。

*   **卡点三：Demo能跑，但不敢交付；每次联调都需人肉紧盯，心力交瘁。**  
    **解药**：把SpecDD和API文档规范当作铁律来执行。用真实接口用例作为验收门禁，推动项目从"可用"迈向"可交付"。

最后，送上我们用实战换来的**"避坑秘籍"**：  
所有在6小时实战中总结的经验、技巧和修复记录，我们都开源在了项目仓库的`auto_agent/docs/skills`目录中。

---

### **六、加入我们，一起开启AI开发新征程**

如果你正在把大模型嵌进业务系统，或者想把多轮对话、工具调用、流式交互、复杂流程编排做得更稳，欢迎来到Agently的阵营！

*   **体验与交流**：  
    *   官网：Agently.tech（国际站）/ Agently.cn（中文站）  
    *   **微信讨论群**：官网或GitHub主页均有入口  
    *   GitHub：github.com/AgentEra/Agently

*   **与我们并肩作战**：  
    *   **加入团队（含实习）**：hr@agently.tech  
    *   **商务合作**：business@agently.tech

**用VibeCoding+Agently，开启AI应用开发的新篇章！🚀**
